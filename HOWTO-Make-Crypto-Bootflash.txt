== Прототип шифрушки (шифрованной флэшки) ==
=== Руководство по подготовке ===

  Образ дистрибутива для шифрушки собирается по профилю
mkimage-profiles-desktop последовательностью команд

  ./configure --with-distro=custom --with-imagetype=flash
  make crypto-flash

  Для тестирования прототипа подойдёт любое съёмное устройство
достаточного объёма.

  Шифрушка должна быть разбита минимум на 2 раздела:
  
   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1   *           1         134     1055085    b  W95 FAT32
/dev/sdb2             135        1023     6999986    b  W95 FAT32

  Первый раздел нужен для установки на него образа готового к запуску
дистрибутива. Эту опрерацию можно выполнить с помошью программы
mkbootflash.

  На остальных разделах могут размещаться зашифрованные данные
пользователей. Для того, чтобы раздел был автоматически распознан и
подмонтирован, необходимо наличие на нём следующей файловой структуры:

  /<имя пользователя>/.encfs6.xml

где <имя пользователя> должно совпадать с именем пользователя в системе.
При загрузке служба livecd-encfs производит поиск разделов, содржащих
такие файловые стуркутуры, монтирует их и вносит изменения в файл
/etc/security/pam_encfs.conf. При входе пользователя в систему,
директория, содержащая зашифрованные данные монтируется в расшифрованном
виде в домашнюю директорию пользователя (/home/<имя пользователя>).

  Для успешной расшифровке данных, необходимо, чтобы пароль пользователя
совпадал с паролем зашифрованного ключа, который храниться в файле
.encfs6.xml.

  При сборке образа дистрибутива для шифрушки автоматически создаётся
учётная запись с именем altlinux и паролем altlinux, поэтому в корне
второго раздела шифрушки необходимо создать директорию altlinux, в
которой будут размещаться личные файлы пользователя altlinux.

  Директорию нужно инициализировать для работы с шифрованной
файловой системой EncFS. Это можно сделать двумя способами:
воспользоваться программой encfs или скопировать в директорию готовый
файл .encfs6.xml. При инициализации директории с помошью программы
encfs появляется возможность выбрать пароль и параметры шифрования.

  Для изменения пароля можно воспользоваться программой encfsctl.
