default: all

SQUASHFS_VERSION=@SQUASHFS_VERSION@

# Include mkimage config file with default definitions
include @MKI_PREFIX@/usr/share/mkimage/config.mk

# packagelist stuff
include ../functions.mk

#Include autogenerated settings for specific product flavor
# Not neccessary for clean family targets.
-include stage-autocfg.mk

CHROOT_PACKAGES = apt-utils rsync

IMAGE_INIT_LIST = +branding-@BRANDING@-release

# FIXME: branding will be optimized out being in main IIRC
IMAGE_PACKAGES = branding-@BRANDING@-release \
                 $(call list,$(GLOBAL_ADDON_PACKAGE_LISTS))

MKI_DESTDIR = ALTLinux/RPMS.addon

MKI_PACKTYPE = data

INFO_NAME	= ALT Linux Addon
INFO_LABEL	= @LABEL@ 

# Include mkimage targets definitions
include @MKI_PREFIX@/usr/share/mkimage/targets.mk

default: all

all: rm-pkg-groups-base copy-packages pack-image pkg-groups-base

# FIXME: this should be generated in pkg/Makefile probably
# NB: alterator-pkg depends on it being lists/.base in Metadata.tar
pkg-groups-base:
	@echo "Preparing pkg-groups-base..."
	mkdir -p `dirname $(call list,.base)`
	cat $(call list,$(LOCAL_ADDON_PACKAGE_LISTS)) \
		$(call list,$(GLOBAL_ADDON_PACKAGE_LISTS)) \
		  | sed -e 's/#.*//' \
		      -e 's/[^[:space:]]*-\([[:space:]]\+\|$$\)//g' \
		      -e 's/[[:space:]]\+/\n/g' \
			> $(call list,.base)

rm-pkg-groups-base:
	rm -f $(call list,.base)
